// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  GUEST
  ADMIN
}

model User {
  id        Int       @id @default(autoincrement())
  email     String    @unique
  password  String
  name      String
  role      UserRole  @default(GUEST)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  reservations Reservation[]
}

model Hotel {
  id        Int       @id @default(autoincrement())
  name      String
  location  String
  description String?
  rating    Float     @default(0)
  imageUrl  String?   // Cloudinary URL
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  rooms Room[]
}

model Room {
  id        Int       @id @default(autoincrement())
  roomNumber String
  hotelId   Int
  type      String    // e.g., "Single", "Double", "Suite"
  price     Float
  capacity  Int
  imageUrl  String?   // Cloudinary URL
  description String?
  amenities String[]  // JSON array of amenities: ["WiFi", "AC", "TV", etc.]
  isAvailable Boolean @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  hotel       Hotel         @relation(fields: [hotelId], references: [id], onDelete: Cascade)
  reservations Reservation[]

  @@unique([hotelId, roomNumber])
}

model Reservation {
  id        Int       @id @default(autoincrement())
  userId    Int
  roomId    Int
  checkInDate DateTime
  checkOutDate DateTime
  totalPrice Float
  refundAmount Float?   // Amount to be refunded if cancelled
  status    String    @default("PENDING") // PENDING, CONFIRMED, CANCELLED
  cancellationDate DateTime? // When the reservation was cancelled
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  room      Room      @relation(fields: [roomId], references: [id], onDelete: Cascade)
}
